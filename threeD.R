
#  8 ------ 7
# /|       /|
# 5 ------ 6|
# ||      | |
# |4 ------ 3
# |/      |/
# 1 ------2


#################################################################################
# Functions for rotating and plotting 3D-objects (points, wireframes or polygons)
#################################################################################

readOBJ=function(file){
	data=readLines(file,warn=F)
	f=grep("^f ",data,value=T)
	v=grep("^v ",data,value=T)
	l=grep("^l ",data,value=T)
	return(list(
		"ver"=as.numeric(grep("[^v]",unlist(strsplit(v,"[ \n\r]+")),value=T)),		
		"pol"=as.numeric(gsub("/.*","",grep("[^f]",unlist(strsplit(f,"[ \n\r]+")),value=T))),
		"con"=unlist(lapply(strsplit(l,"[ \n\r]+"),function(x) as.numeric(rbind(x[-length(x)],x[-1])[,-1])))
	))
}
xRotateRver=function(rver,theta){
	while(theta>=360) theta=theta-360
	theta[theta<0]=0
	theta=theta*pi/180
	ct=cos(theta)
	st=sin(theta)
	rver2=rver
	rver2["yx"]=rver["yx"]*ct+rver["zx"]*st
	rver2["yy"]=rver["yy"]*ct+rver["zy"]*st
	rver2["yz"]=rver["yz"]*ct+rver["zz"]*st
	rver2["y0"]=rver["y0"]*ct+rver["z0"]*st
	rver2["zx"]=rver["zx"]*ct-rver["yx"]*st
	rver2["zy"]=rver["zy"]*ct-rver["yy"]*st
	rver2["zz"]=rver["zz"]*ct-rver["yz"]*st
	rver2["z0"]=rver["z0"]*ct-rver["y0"]*st
	rver2
}
yRotateRver=function(rver,theta){
	while(theta>=360) theta=theta-360
	theta[theta<0]=0
	theta=theta*pi/180
	ct=cos(theta)
	st=sin(theta)
	rver2=rver
	rver2["xx"]=rver["xx"]*ct+rver["zx"]*st
	rver2["xy"]=rver["xy"]*ct+rver["zy"]*st
	rver2["xz"]=rver["xz"]*ct+rver["zz"]*st
	rver2["x0"]=rver["x0"]*ct+rver["z0"]*st
	rver2["zx"]=rver["zx"]*ct-rver["xx"]*st
	rver2["zy"]=rver["zy"]*ct-rver["xy"]*st
	rver2["zz"]=rver["zz"]*ct-rver["xz"]*st
	rver2["z0"]=rver["z0"]*ct-rver["x0"]*st
	rver2
}
zRotateRver=function(rver,theta){
	while(theta>=360) theta=theta-360
	theta[theta<0]=0
	theta=theta*pi/180
	ct=cos(theta)
	st=sin(theta)
	rver2=rver
	rver2["yx"]=rver["yx"]*ct+rver["xx"]*st
	rver2["yy"]=rver["yy"]*ct+rver["xy"]*st
	rver2["yz"]=rver["yz"]*ct+rver["xz"]*st
	rver2["y0"]=rver["y0"]*ct+rver["x0"]*st
	rver2["xx"]=rver["xx"]*ct-rver["yx"]*st
	rver2["xy"]=rver["xy"]*ct-rver["yy"]*st
	rver2["xz"]=rver["xz"]*ct-rver["yz"]*st
	rver2["x0"]=rver["x0"]*ct-rver["y0"]*st
	rver2
}
transformRver=function(rver,ver,thetaX=NULL,thetaY=NULL,thetaZ=NULL,persp=0){
	tver=ver*0
	if(!is.null(thetaX)) rver=xRotateRver(rver,thetaX)
	if(!is.null(thetaY)) rver=yRotateRver(rver,thetaY)
	if(!is.null(thetaZ)) rver=zRotateRver(rver,thetaZ)
	for(i in seq(length(ver),1,by=-3)-2){
		tver[i+0]=ver[i]*rver["xx"]+ver[i+1]*rver["xy"]+ver[i+2]*rver["xz"]+rver["x0"]
		tver[i+1]=ver[i]*rver["yx"]+ver[i+1]*rver["yy"]+ver[i+2]*rver["yz"]+rver["y0"]
		tver[i+2]=ver[i]*rver["zx"]+ver[i+1]*rver["zy"]+ver[i+2]*rver["zz"]+rver["z0"]
		if(persp>0){
			tver[i+0]=tver[i+0]*(1-tver[i+2]/persp)
			tver[i+1]=tver[i+1]*(1-tver[i+2]/persp)
		}
	}
	return(tver)
}
translateRver=function(rver,fx,fy,fz){
	rver["x0"]=rver["x0"]+fx
	rver["y0"]=rver["y0"]+fy
	rver["z0"]=rver["z0"]+fz
	rver
}
scaleRver=function(rver,fx,fy,fz){
	rver["xx"]=rver["xx"]*fx;rver["xy"]=rver["xy"]*fx;rver["xz"]=rver["xz"]*fx;rver["x0"]=rver["x0"]*fx
	rver["yx"]=rver["yx"]*fy;rver["yy"]=rver["yy"]*fy;rver["yz"]=rver["yz"]*fy;rver["y0"]=rver["y0"]*fy
	rver["zx"]=rver["zx"]*fz;rver["zy"]=rver["zy"]*fz;rver["zz"]=rver["zz"]*fz;rver["z0"]=rver["z0"]*fz
	rver
}
toStringRver=function(rver) {
	x=paste0("[",rver["x0"],",",rver["xx"],",",rver["xy"],",",rver["xz"],";\n",
		     rver["y0"],",",rver["yx"],",",rver["yy"],",",rver["yz"],";\n",
		     rver["z0"],",",rver["zx"],",",rver["zy"],",",rver["zz"],"]");
	message(x);return(x);
}
unitRver=function(){
	rver=numeric(0)
	rver["xx"]=1; rver["xy"]=0; rver["xz"]=0; rver["x0"]=0
	rver["yx"]=0; rver["yy"]=1; rver["yz"]=0; rver["y0"]=0
	rver["zx"]=0; rver["zy"]=0; rver["zz"]=1; rver["z0"]=0
	rver
}
polArea=function(a,b,c) (a[1]*b[2]-a[2]*b[1] + b[1]*c[2]-b[2]*c[1] + b[1]*a[2]-b[2]*a[1])/2
vecToVer=function(x,y,z) c(sapply(1:length(x), function(i) c(x[i],y[i],z[i])))
vecLength=function(...)sqrt(sum(sapply(...,function(x)x^2)))
vecDistance=function(a,b)sqrt(sum(sapply(1:length(a),function(i)(a[i]-b[i])^2)))
vecCrossProduct <- function(x,y) {
	if (is.vector(x) && is.vector(y)) {
		if (length(x) == length(y) && length(x) == 3) {
			xxy <- c(x[2]*y[3] - x[3]*y[2],
			        x[3]*y[1] - x[1]*y[3],
    		         	x[1]*y[2] - x[2]*y[1])
		}
	} else {
		if (is.matrix(x) && is.matrix(y)) {
			if (all(dim(x) == dim(y))) {
				if (ncol(x) == 3) {
                    			xxy <- cbind(x[, 2]*y[, 3] - x[, 3]*y[, 2],
        			             	x[, 3]*y[, 1] - x[, 1]*y[, 3],
            		             		x[,1 ]*y[, 2] - x[, 2]*y[, 1])
				} else {
					if (nrow(x) == 3) {
                        			xxy <- rbind(x[2, ]*y[3, ] - x[3, ]*y[2, ],
            			             	x[3, ]*y[1, ] - x[1, ]*y[3, ],
                		             	x[1, ]*y[2, ] - x[2, ]*y[1, ])
					}
				}
			}
		} 
	}
	return(xxy)
}		 
sortCon=function(con,tver,fun=mean){
	if(is.null(fun)) fun=mean
	for(i in seq(1,length(con),by=2))
	for(j in seq(1,length(con),by=2))
	if(fun(c(tver[con[i]*3],tver[con[i+1]*3])) > fun(c(tver[con[j]*3],tver[con[j+1]*3]))){
		h1=con[i];h2=con[i+1];
		con[i]=con[j];con[i+1]=con[j+1];
		con[j]=h1;con[j+1]=h2;
	}
	con
}
sortPol=function(pol,tver,fun=mean){
	if(is.null(fun)) fun=mean
	for(i in seq(1,length(pol),by=3))
	for(j in seq(1,length(pol),by=3))
	#if( max(c(tver[pol[i]*3],tver[pol[i+1]*3],tver[pol[i+2]*3]))>max(c(tver[pol[j]*3],tver[pol[j+1]*3],tver[pol[j+2]*3])) | (max(c(tver[pol[i]*3],tver[pol[i+1]*3],tver[pol[i+2]*3]))==max(c(tver[pol[j]*3],tver[pol[j+1]*3],tver[pol[j+2]*3])) & min(c(tver[pol[i]*3],tver[pol[i+1]*3],tver[pol[i+2]*3]))>min(c(tver[pol[j]*3],tver[pol[j+1]*3],tver[pol[j+2]*3]))) ) {
	if(fun(c(tver[pol[i]*3],tver[pol[i+1]*3],tver[pol[i+2]*3])) > fun(c(tver[pol[j]*3],tver[pol[j+1]*3],tver[pol[j+2]*3]))){
		h1=pol[i];h2=pol[i+1];h3=pol[i+2];
		pol[i]=pol[j];pol[i+1]=pol[j+1];pol[i+2]=pol[j+2];
		pol[j]=h1;pol[j+1]=h2;pol[j+2]=h3;
	}
	return(pol)
}
colourPol=function(pol,tver,col="lightgrey",transparency=0, returnDegree=F){
	d=numeric(0)
	toDegree <- function(rad) rad * 57.29577951308232286465 # double for 180/pi
	for(i in seq(1,length(pol),by=3)){
		x1=tver[pol[i]*3-2];y1=tver[pol[i]*3-1];z1=tver[pol[i]*3-0]
		x2=tver[pol[i+1]*3-2];y2=tver[pol[i+1]*3-1];z2=tver[pol[i+1]*3-0]
		x3=tver[pol[i+2]*3-2];y3=tver[pol[i+2]*3-1];z3=tver[pol[i+2]*3-0]
		v1=(y1-y2)*(z3-z2)-(z1-z2)*(y3-y2)
		v2=(z1-z2)*(x3-x2)-(x1-x2)*(z3-z2)
		v3=(x1-x2)*(y3-y2)-(y1-y2)*(x3-x2)
		d=c(d,asin(sqrt((v1*v1+v2*v2)/(v1*v1+v2*v2+v3*v3))))
	}
	d=toDegree(d)
	if(returnDegree) return(d)
	d=round(d)
	cols=unlist(lapply(1:length(d),function(i){
		apply(col2rgb(col), 2, function(x)
			rgb( max(0,min(1,(x[1]-d[i])/255)), max(0,min(1,(x[2]-d[i])/255)), max(0,min(1,(x[3]-d[i])/255)), 1-transparency)
		)
	}))
	cols
}
form=function(form="cube",verbose=F)
	if(form=="cube") {
		if(verbose)message("Cube\n\n8 ------ 7 \n /|       /| \n 5 ------ 6| \n ||      | | \n |4 ------ 3 \n |/      |/  \n 1 ------2   ")
		return(list(
		"ver"=c(-1,-1,-1, +1,-1,-1, +1,-1,+1, -1,-1,+1, -1,+1,-1, +1,+1,-1, +1,+1,+1, -1,+1,+1),
		"pol"=c(1,3,2, 1,4,3, 5,6,7, 5,7,8, 1,2,5, 2,6,5, 2,3,7, 2,7,6, 1,8,4, 1,5,8, 3,4,8, 3,8,7),
		"con"=c(1,2, 2,3, 3,4, 1,4, 5,6, 6,7, 7,8, 5,8, 1,5, 2,6, 3,7, 4,8)))
	} else if(form=="tetrahedron") {
		if(verbose)message("Tetrahedron")
		return(list(
		"ver"=c(2.96984815598,-2.09999990463,-6.16013124954e-08,-1.4849230051,-2.09999990463,-2.57196450233,-1.48492431641,-2.09999966621,2.57196378708,3.36335745033e-07,2.09999990463,-4.2484413143e-07,2.96198511124,-2.0955517292,0.00272379838862,-1.47863388062,-2.09555149078,2.56651616096,0.00157295458484,2.09110379219,0.00272343261167,2.9609041214,-2.09999990463,-7.07106266873e-08,-1.48045098782,-2.09999990463,-2.56421875954,-1.48045241833,-2.09999966621,2.56421804428,2.96260070801,-2.09590005875,-0.00251049129292,-1.47912502289,-2.09590005875,-2.56694340706,0.00144981057383,2.09180021286,-0.00251102261245,-1.48225963116,-2.09246683121,-2.55812525749,-1.48226094246,-2.09246659279,2.55812454224,-0.00532644148916,2.08493375778,-4.17800976038e-07),
		"pol"=c(1,3,6,5,4,1,5,7,3,4,7,6,5,7,6,1,2,9,8,2,3,10,9,3,1,8,10,8,10,9,2,1,11,12,1,4,13,11,4,2,12,13,11,12,13,3,2,14,15,2,4,16,14,4,3,15,16,14,15,16),
		"con"=NULL))
	} else if(form=="cone") {
		if(verbose)message("Cone")
		return(list(
		"ver"=c(-1.89999985695,-2.09996962547,-1.89999985695,-1.49282026291,-2.09996962547,-2.23416376114,-1.02827262878,-2.09996962547,-2.48246955872,-0.524208903313,-2.09996962547,-2.63537549973,-2.37264401903e-07,-2.09996962547,-2.68700575829,0.524208426476,-2.09996962547,-2.63537573814,1.02827215195,-2.09996962547,-2.48246979713,1.4928201437,-2.09996962547,-2.23416376114,1.89999985695,-2.09996962547,-1.90000009537,2.23416376114,-2.09996962547,-1.49282026291,2.48246955872,-2.09996962547,-1.02827227116,2.63537573814,-2.09996962547,-0.524208247662,2.68700575829,-2.09996962547,7.58084865993e-07,2.63537526131,-2.09996962547,0.524209797382,2.48246908188,-2.09996962547,1.02827358246,2.23416280746,-2.09996962547,1.49282157421,1.89999890327,-2.09996962547,1.90000092983,1.49281895161,-2.09996962547,2.23416471481,1.02827072144,-2.09996962547,2.48247027397,0.524206638336,-2.09996962547,2.63537597656,-2.39406608671e-06,-2.09996962547,2.68700575829,-0.524211347103,-2.09996962547,2.63537502289,-1.02827513218,
			-2.09996962547,2.48246836662,-1.49282288551,-2.09996962547,2.23416161537,-1.90000236034,-2.09996962547,1.89999759197,-2.23416543007,-2.09996986389,1.49281740189,-2.48247098923,-2.09996986389,1.02826905251,-2.6353764534,-2.09996986389,0.524204909801,-2.68700575829,-2.09996986389,-4.19615116698e-06,-2.63537478447,-2.09996986389,-0.524213135242,-2.48246765137,-2.09996986389,-1.02827680111,-2.23416090012,-2.09996986389,-1.49282431602,-8.30516313499e-08,2.75455951691,3.63030189677e-15,8.30516384553e-08,-2.09996962547,-3.63030316732e-15),
		"pol"=c(2,1,33,33,3,2,33,4,3,33,5,4,33,6,5,33,7,6,33,8,7,33,9,8,33,10,9,33,11,10,33,12,11,33,13,12,33,14,13,33,15,14,33,16,15,33,17,16,33,18,17,33,19,18,33,20,19,33,21,20,33,22,21,33,23,22,33,24,23,33,25,24,33,26,25,33,27,26,33,28,27,33,29,28,33,30,29,33,31,30,33,32,31,33,1,32,34,1,2,34,2,3,34,3,4,34,4,5,34,5,6,34,6,7,34,7,8,34,8,9,34,9,10,34,10,11,34,11,12,34,12,13,34,13,14,34,14,15,34,15,16,34,16,17,34,17,18,34,18,19,34,19,20,34,20,21,34,21,22,34,22,23,34,23,24,34,24,25,34,25,26,34,26,27,34,27,28,34,28,29,34,29,30,34,30,31,34,31,32,32,1,34),
		"con"=NULL))
	} else if(form=="torus") {
		if(verbose)message("Torus")
		return(list(
		"ver"=c(1.226013,0.507813,0.227051,1.302643,0.539551,0,1.409973,0,0,1.327057,0,0.227051,1.032318,0.427582,0.347321,1.117401,0,0.347321,0.812622,0.336578,0.30426,0.879578,0,0.30426,0.670166,0.277588,0.118073,0.725403,0,0.118073,0.672028,0.278351,-0.123627,0.727417,0,-0.123627,0.817352,0.338531,-0.30719,0.884705,0,-0.30719,1.03772,0.42984,-0.346283,1.12323,0,-0.346283,1.229523,0.509277,-0.222504,1.330841,0,-0.222504,0.938354,0.938324,0.227051,0.996979,0.996979,0,0.7901,0.79007,0.347321,0.621948,0.621918,0.30426,0.512909,0.512909,0.118073,0.514343,0.514313,-0.123627,0.62558,0.625549,-0.30719,0.79422,0.79422,-0.346283,0.94101,0.94101,-0.222504,0.507843,1.225983,0.227051,0.539551,1.302612,0,0.427582,1.032257,0.347321,0.336578,0.812561,0.30426,0.277557,0.670135,0.118073,0.278351,0.671967,-0.123627,0.338562,0.817322,-0.30719,0.42981,1.037689,-0.346283,0.509247,1.229462,-0.222504,0,1.326996,0.227051,0,1.409912,0,0,1.11731,0.347321,0,0.879486,0.30426,0,0.725311,0.118073,0,0.727325,-0.123627,0,0.884644,
-0.30719,0,1.123169,-0.346283,0,1.33075,-0.222504,-0.507813,1.225983,0.227051,-0.53952,1.302582,0,-0.427551,1.032257,0.347321,-0.336548,0.812531,0.30426,-0.277557,0.670074,0.118073,-0.27832,0.671936,-0.123627,-0.338531,0.817291,-0.30719,-0.42981,1.037659,-0.346283,-0.509247,1.229431,-0.222504,-0.938293,0.938324,0.227051,-0.996918,0.996948,0,-0.790009,0.790039,0.347321,-0.621857,0.621887,0.30426,-0.512848,0.512848,0.118073,-0.514252,0.514252,-0.123627,-0.625519,0.625519,-0.30719,-0.794159,0.794189,-0.346283,-0.940948,0.940948,-0.222504,-1.225922,0.507813,0.227051,-1.302521,0.539551,0,-1.032196,0.427551,0.347321,-0.8125,0.336548,0.30426,-0.670044,0.277527,0.118073,-0.671875,0.27829,-0.123627,-0.817261,0.338501,-0.30719,-1.037628,0.42981,-0.346283,-1.229401,0.509216,-0.222504,-1.326935,0,0.227051,-1.409821,0,0,-1.117218,0,0.347321,-0.879425,0,0.30426,-0.72522,0,0.118073,-0.727203,0,-0.123627,-0.884583,0,-0.30719,-1.123108,0,-0.346283,-1.330658,0,-0.222504,-1.225922,-0.507782,0.227051,-1.30249,-0.53949,0,
-1.032166,-0.427521,0.347321,-0.812469,-0.336517,0.30426,-0.670013,-0.277527,0.118073,-0.671844,-0.278259,-0.123627,-0.81723,-0.338501,-0.30719,-1.037598,-0.429779,-0.346283,-1.22934,-0.509216,-0.222504,-0.938263,-0.938263,0.227051,-0.996887,-0.996857,0,-0.789978,-0.789948,0.347321,-0.621826,-0.621796,0.30426,-0.512787,-0.512787,0.118073,-0.514191,-0.51416,-0.123627,-0.625458,-0.625458,-0.30719,-0.794128,-0.794128,-0.346283,-0.940887,-0.940887,-0.222504,-0.507782,-1.225891,0.227051,-0.53952,-1.30246,0,-0.427521,-1.032104,0.347321,-0.336517,-0.812408,0.30426,-0.277496,-0.669983,0.118073,-0.278259,-0.671783,-0.123627,-0.33847,-0.8172,-0.30719,-0.429779,-1.037567,-0.346283,-0.509186,-1.229309,-0.222504,0,-1.326874,0.227051,0,-1.40976,0,0,-1.117126,0.347321,0,-0.879333,0.30426,0,-0.725159,0.118073,0,-0.727112,-0.123627,0,-0.884491,-0.30719,0,-1.123047,-0.346283,0,-1.330566,-0.222504,0.507751,-1.225861,0.227051,0.53949,-1.302429,0,0.42749,-1.032074,0.347321,0.336487,-0.812378,0.30426,0.277496,-0.669952,
0.118073,0.278229,-0.671753,-0.123627,0.33847,-0.817139,-0.30719,0.429749,-1.037537,-0.346283,0.509155,-1.229279,-0.222504,0.938202,-0.938232,0.227051,0.996826,-0.996826,0,0.789886,-0.789917,0.347321,0.621735,-0.621765,0.30426,0.512726,-0.512756,0.118073,0.514099,-0.51413,-0.123627,0.625397,-0.625397,-0.30719,0.794067,-0.794098,-0.346283,0.940796,-0.940857,-0.222504,1.22583,-0.507751,0.227051,1.302399,-0.539459,0,1.032043,-0.42749,0.347321,0.812317,-0.336487,0.30426,0.669891,-0.277496,0.118073,0.671692,-0.278229,-0.123627,0.817108,-0.33844,-0.30719,1.037506,-0.429749,-0.346283,1.229218,-0.509186,-0.222504),
		"pol"=c(1,2,3,1,3,4,5,1,4,5,4,6,7,5,6,7,6,8,9,7,8,9,8,10,11,9,10,11,10,12,13,11,12,13,12,14,15,13,14,15,14,16,17,15,16,17,16,18,3,2,17,18,3,17,19,20,2,19,2,1,21,19,1,21,1,5,22,21,5,22,5,7,23,22,7,23,7,9,24,23,9,24,9,11,25,24,11,25,11,13,26,25,13,26,13,15,27,26,15,27,15,17,27,2,20,27,17,2,28,29,20,28,20,19,30,28,19,30,19,21,31,30,21,31,21,22,32,31,22,32,22,23,33,32,23,33,23,24,34,33,24,34,24,25,35,34,25,35,25,26,36,35,26,36,26,27,36,20,29,36,27,20,37,38,29,37,29,28,39,37,28,39,28,30,40,39,30,40,30,31,41,40,31,41,31,32,42,41,32,42,32,33,43,42,33,43,33,34,44,43,34,44,34,35,45,44,35,45,35,36,45,29,38,45,36,29,46,47,38,46,38,37,48,46,37,48,37,39,49,48,39,49,39,40,50,49,40,50,40,41,51,50,41,51,41,42,52,51,42,52,42,43,53,52,43,53,43,44,54,53,44,54,44,45,54,38,47,54,45,38,55,56,47,55,47,46,57,55,46,57,46,48,58,57,48,58,48,49,59,58,49,59,49,50,60,59,50,60,50,51,61,60,51,61,51,52,62,61,52,62,52,53,63,62,53,63,53,54,63,47,56,63,54,47,64,65,56,64,56,55,66,64,55,66,55,57,67,66,57,67,57,58,68,67,58,68,58,59,
69,68,59,69,59,60,70,69,60,70,60,61,71,70,61,71,61,62,72,71,62,72,62,63,72,56,65,72,63,56,73,74,65,73,65,64,75,73,64,75,64,66,76,75,66,76,66,67,77,76,67,77,67,68,78,77,68,78,68,69,79,78,69,79,69,70,80,79,70,80,70,71,81,80,71,81,71,72,81,65,74,81,72,65,82,83,74,82,74,73,84,82,73,84,73,75,85,84,75,85,75,76,86,85,76,86,76,77,87,86,77,87,77,78,88,87,78,88,78,79,89,88,79,89,79,80,90,89,80,90,80,81,90,74,83,90,81,74,91,92,83,91,83,82,93,91,82,93,82,84,94,93,84,94,84,85,95,94,85,95,85,86,96,95,86,96,86,87,97,96,87,97,87,88,98,97,88,98,88,89,99,98,89,99,89,90,99,83,92,99,90,83,100,101,92,100,92,91,102,100,91,102,91,93,103,102,93,103,93,94,104,103,94,104,94,95,105,104,95,105,95,96,106,105,96,106,96,97,107,106,97,107,97,98,108,107,98,108,98,99,108,92,101,108,99,92,109,110,101,109,101,100,111,109,100,111,100,102,112,111,102,112,102,103,113,112,103,113,103,104,114,113,104,114,104,105,115,114,105,115,105,106,116,115,106,116,106,107,117,116,107,117,107,108,117,101,110,117,108,101,118,119,110,118,110,109,120,118,109,120,
109,111,121,120,111,121,111,112,122,121,112,122,112,113,123,122,113,123,113,114,124,123,114,124,114,115,125,124,115,125,115,116,126,125,116,126,116,117,126,110,119,126,117,110,127,128,119,127,119,118,129,127,118,129,118,120,130,129,120,130,120,121,131,130,121,131,121,122,132,131,122,132,122,123,133,132,123,133,123,124,134,133,124,134,124,125,135,134,125,135,125,126,135,119,128,135,126,119,136,137,128,136,128,127,138,136,127,138,127,129,139,138,129,139,129,130,140,139,130,140,130,131,141,140,131,141,131,132,142,141,132,142,132,133,143,142,133,143,133,134,144,143,134,144,134,135,144,128,137,144,135,128,137,136,3,136,4,3,3,144,137,3,18,144,136,138,4,138,6,4,138,139,6,139,8,6,139,140,8,140,10,8,140,141,10,141,12,10,141,142,12,142,14,12,142,143,14,143,16,14,143,144,16,144,18,16),
		"con"=NULL))
	} else if(form=="sphere") {
		if(verbose)message("Sphere")
		return(list(
		"ver"=c(0,0.5,-2.54558420181,1.84198486805,-0.838264584541,-1.13842344284,-0.703561306,-1.66537570953,-1.13842344284,-2.27683401108,0.5,-1.13842344284,-0.703561306,2.66537570953,-1.13842344284,1.84198486805,1.83826458454,-1.13842344284,0.703561306,-1.66537570953,1.13842344284,-1.84198486805,-0.838264584541,1.13842344284,-1.84198486805,1.83826458454,1.13842344284,0.703561306,2.66537570953,1.13842344284,2.27683401108,0.5,1.13842344284,0,0.5,2.54558420181,1.08269488811,-0.286614596844,-2.16541218758,-0.413544327021,-0.772780179977,-2.16541218758,0.669154822826,-1.55940723419,-1.33830952644,1.08269488811,1.28661465645,-2.16541218758,2.16539573669,0.5,-1.33830487728,-1.33828949928,0.5,-2.16540551186,-1.7518440485,-0.772784352303,-1.33830583096,-0.413544327021,1.77278017998,-2.16541218758,-1.7518440485,1.7727843523,-1.33830583096,0.669154822826,2.55940723419,-1.33830952644,2.42099809647,1.28661775589,0,2.42099809647,-0.28661775589,0,1.49625790119,-1.5594201088,0,0,-2.04558420181,0,
-1.49625790119,-1.5594201088,0,-2.42099809647,-0.28661775589,0,-2.42099809647,1.28661775589,0,-1.49625790119,2.5594201088,0,0,3.04558420181,0,1.49625790119,2.5594201088,0,1.7518440485,-0.772784352303,1.33830583096,-0.669154822826,-1.55940723419,1.33830952644,-2.16539573669,0.5,1.33830487728,-0.669154822826,2.55940723419,1.33830952644,1.7518440485,1.7727843523,1.33830583096,1.33828949928,0.5,2.16540551186,0.413544327021,-0.772780179977,2.16541218758,-1.08269488811,-0.286614596844,2.16541218758,-1.08269488811,1.28661465645,2.16541218758,0.413544327021,1.77278017998,2.16541218758,1.27628755569,2.28711080551,1.28737151623,2.09404230118,1.1615729332,1.28736424446,0.580656588078,2.28710746765,1.71728980541,0.214953452349,1.16156983376,2.44869756699,1.87908375263,0.5,1.71727788448,0.695621073246,0.5,2.44869589806,1.13841235638,1.83828282356,1.84201407433,0.920993208885,1.16913986206,2.27684497833,1.62457787991,1.16914176941,1.84200847149,-1.30525624752,2.26606321335,1.28737187386,0.0178840458393,
2.69598531723,1.28737258911,-1.52020871639,1.60448336601,1.71728873253,-0.562766730785,0.908869147301,2.44869756699,-0.921001434326,1.99624156952,1.84201455116,-0.351792931557,1.58268678188,2.27684664726,-0.134382337332,2.25183391571,1.84201490879,-2.08298039436,-0.19561111927,1.287368536,-2.08298039436,1.19561111927,1.287368536,-1.52020871639,-0.604483366013,1.71728873253,-0.562766730785,0.0911308526993,2.44869756699,-1.70762121677,0.0864524841309,1.84201192856,-1.13841044903,0.5,2.2768445015,-1.70762121677,0.913547515869,1.84201192856,0.0178840458393,-1.69598531723,1.28737258911,-1.30525624752,-1.26606333256,1.28737187386,0.580656588078,-1.28710758686,1.71728980541,0.214953452349,-0.16156989336,2.44869756699,-0.134382337332,-1.25183391571,1.84201490879,-0.351792931557,-0.582686781883,2.27684664726,-0.921001434326,-0.996241569519,1.84201455116,1.27628755569,-1.2871106863,1.28737151623,2.09404230118,-0.161572933197,1.28736424446,1.62457787991,-0.169141769409,1.84200847149,0.920993208885,
-0.169139921665,2.27684497833,1.13841235638,-0.838282823563,1.84201407433,1.73517549038,2.26607275009,-0.591737806797,1.14343810081,2.69599509239,0.591738045216,2.21584224701,1.60448586941,-0.591737508774,2.44185876846,0.908871412277,0.591734528542,2.05942463875,1.9962515831,0,2.19379520416,1.58269298077,0.703589677811,1.70762968063,2.2518453598,0.703589677811,-1.14343810081,2.69599509239,-0.591738045216,-1.73517549038,2.26607275009,0.591737806797,-0.365701913834,2.9486951828,-0.591737627983,0.365701913834,2.9486951828,0.591737627983,-0.7866294384,2.92099428177,0,-0.351796030998,2.92099094391,0.703592061996,-1.13842558861,2.66539716721,0.703591346741,-2.44185876846,0.0911285579205,-0.591734528542,-2.21584224701,-0.604485869408,0.591737508774,-2.44185876846,0.908871412277,-0.591734528542,-2.21584224701,1.60448586941,0.591737508774,-2.54558420181,0.5,0,-2.41121101379,0.913549661636,0.70358890295,-2.41121101379,0.086450368166,0.70358890295,-0.365701913834,-1.9486951828,-0.591737627983,0.365701913834,
-1.9486951828,0.591737627983,-1.14343810081,-1.69599509239,-0.591738045216,-1.73517549038,-1.26607263088,0.591737806797,-0.7866294384,-1.92099428177,0,-1.13842558861,-1.66539716721,0.703591346741,-0.351796030998,-1.92099094391,0.703592061996,2.21584224701,-0.604485869408,-0.591737508774,2.44185876846,0.0911285579205,0.591734528542,1.14343810081,-1.69599509239,0.591738045216,1.73517549038,-1.26607263088,-0.591737806797,2.05942463875,-0.996251583099,0,1.70762968063,-1.25184524059,0.703589677811,2.19379520416,-0.582692980766,0.703589677811,-0.0178840458393,2.69598531723,-1.28737258911,1.30525624752,2.26606321335,-1.28737187386,0.351796030998,2.92099094391,-0.703592061996,0.7866294384,2.92099428177,0,1.13842558861,2.66539716721,-0.703591346741,-2.09404230118,1.1615729332,-1.28736424446,-1.27628755569,2.28711080551,-1.28737151623,-2.19379520416,1.58269298077,-0.703589677811,-2.05942463875,1.9962515831,0,-1.70762968063,2.2518453598,-0.703589677811,-1.27628755569,-1.2871106863,-1.28737151623,-2.09404230118,
-0.161572933197,-1.28736424446,-1.70762968063,-1.25184524059,-0.703589677811,-2.05942463875,-0.996251583099,0,-2.19379520416,-0.582692980766,-0.703589677811,-0.0178840458393,-1.69598531723,-1.28737258911,1.30525624752,-1.26606333256,-1.28737187386,1.13842558861,-1.66539716721,-0.703591346741,0.7866294384,-1.92099428177,0,0.351796030998,-1.92099094391,-0.703592061996,2.08298039436,1.19561111927,-1.287368536,2.08298039436,-0.19561111927,-1.287368536,2.41121101379,0.913549661636,-0.70358890295,2.54558420181,0.5,0,2.41121101379,0.086450368166,-0.70358890295,-0.580656588078,2.28710746765,-1.71728980541,-0.214953452349,1.16156983376,-2.44869756699,1.52020871639,1.60448336601,-1.71728873253,0.562766730785,0.908869147301,-2.44869756699,0.351792931557,1.58268678188,-2.27684664726,0.921001434326,1.99624156952,-1.84201455116,0.134382337332,2.25183391571,-1.84201490879,-1.87908375263,0.5,-1.71727788448,-0.695621073246,0.5,-2.44869589806,-0.920993208885,1.16913986206,-2.27684497833,-1.13841235638,1.83828282356,
-1.84201407433,-1.62457787991,1.16914176941,-1.84200847149,-0.580656588078,-1.28710758686,-1.71728980541,-0.214953452349,-0.16156989336,-2.44869756699,-0.920993208885,-0.169139921665,-2.27684497833,-1.62457787991,-0.169141769409,-1.84200847149,-1.13841235638,-0.838282823563,-1.84201407433,0.562766730785,0.0911308526993,-2.44869756699,1.52020871639,-0.604483366013,-1.71728873253,1.13841044903,0.5,-2.2768445015,1.70762121677,0.913547515869,-1.84201192856,1.70762121677,0.0864524841309,-1.84201192856,0.351792931557,-0.582686781883,-2.27684664726,0.134382337332,-1.25183391571,-1.84201490879,0.921001434326,-0.996241569519,-1.84201455116),
		"pol"=c(160,162,161,157,158,159,152,154,153,147,149,148,142,144,143,135,136,137,130,131,132,125,126,127,120,121,122,115,116,117,110,112,111,103,105,104,96,98,97,89,91,90,82,84,83,75,76,77,70,71,72,63,64,65,56,57,58,49,50,51,45,49,43,48,50,46,44,51,47,54,56,52,46,57,55,53,58,45,61,63,59,55,64,62,60,65,54,68,70,66,62,71,69,67,72,61,47,75,74,69,76,48,73,77,68,80,78,82,44,81,83,79,43,84,87,85,89,53,88,90,86,52,91,94,92,96,60,95,97,93,59,98,101,99,103,67,102,104,100,66,105,109,106,110,73,108,111,107,74,112,87,115,113,79,116,88,114,117,78,94,120,118,86,121,95,119,122,85,101,125,123,93,126,102,124,127,92,109,130,129,100,131,108,128,132,99,80,135,133,107,136,81,134,137,106,141,139,142,114,140,143,138,113,144,139,146,147,119,138,148,145,118,149,146,151,152,124,145,153,150,123,154,141,157,155,133,158,140,156,159,134,151,155,160,128,150,161,156,129,162,13,156,162,15,162,129,2,129,156,15,128,161,14,161,150,3,150,128,14,151,160,13,160,155,1,155,151,13,159,156,17,134,159,2,156,134,17,158,133,16,140,158,6,133,
140,16,157,141,13,155,157,1,141,155,14,150,154,19,154,123,3,123,150,19,124,153,18,153,145,4,145,124,18,146,152,14,152,151,1,151,146,18,145,149,21,149,118,4,118,145,21,119,148,20,148,138,5,138,119,20,139,147,18,147,146,1,146,139,20,138,144,22,144,113,5,113,138,22,114,143,16,143,140,6,140,114,16,141,142,20,142,139,1,139,141,17,137,134,24,106,137,2,134,106,24,136,107,23,81,136,11,107,81,23,135,80,17,133,135,6,80,133,15,132,128,26,99,132,3,128,99,26,131,100,25,108,131,7,100,108,25,130,109,15,129,130,2,109,129,19,127,124,28,92,127,4,124,92,28,126,93,27,102,126,8,93,102,27,125,101,19,123,125,3,101,123,21,122,119,30,85,122,5,119,85,30,121,86,29,95,121,9,86,95,29,120,94,21,118,120,4,94,118,22,117,114,32,78,117,6,114,78,32,116,79,31,88,116,10,79,88,31,115,87,22,113,115,5,87,113,24,107,112,33,112,74,11,74,107,33,73,111,25,111,108,7,108,73,25,109,110,24,110,106,2,106,109,26,100,105,34,105,66,7,66,100,34,67,104,27,104,102,8,102,67,27,101,103,26,103,99,3,99,101,28,93,98,35,98,59,8,59,93,35,60,97,29,97,95,9,95,60,29,94,96,
28,96,92,4,92,94,30,86,91,36,91,52,9,52,86,36,53,90,31,90,88,10,88,53,31,87,89,30,89,85,5,85,87,32,79,84,37,84,43,10,43,79,37,44,83,23,83,81,11,81,44,23,80,82,32,82,78,6,78,80,33,77,73,39,68,77,7,73,68,39,76,69,38,48,76,12,69,48,38,75,47,33,74,75,11,47,74,34,72,67,40,61,72,8,67,61,40,71,62,39,69,71,12,62,69,39,70,68,34,66,70,7,68,66,35,65,60,41,54,65,9,60,54,41,64,55,40,62,64,12,55,62,40,63,61,35,59,63,8,61,59,36,58,53,42,45,58,10,53,45,42,57,46,41,55,57,12,46,55,41,56,54,36,52,56,9,54,52,37,51,44,38,47,51,11,44,47,38,50,48,42,46,50,12,48,46,42,49,45,37,43,49,10,45,43,42,50,49,38,51,50,37,49,51,41,57,56,42,58,57,36,56,58,40,64,63,41,65,64,35,63,65,39,71,70,40,72,71,34,70,72,38,76,75,39,77,76,33,75,77,23,82,83,37,83,84,32,84,82,31,89,90,36,90,91,30,91,89,29,96,97,35,97,98,28,98,96,27,103,104,34,104,105,26,105,103,25,110,111,33,111,112,24,112,110,31,116,115,32,117,116,22,115,117,29,121,120,30,122,121,21,120,122,27,126,125,28,127,126,19,125,127,25,131,130,26,132,131,15,130,132,23,136,135,24,137,136,17,135,137,
16,142,143,22,143,144,20,144,142,20,147,148,21,148,149,18,149,147,18,152,153,19,153,154,14,154,152,16,158,157,17,159,158,13,157,159,14,160,161,15,161,162,13,162,160),
		"con"=NULL))
	} else if(form=="frog") {
		if(verbose)message("Frog")
		return(list(
		"ver"=c(24.46339,10.526964,10.528809,21.822266,26.074757,29.712955,18.146168,25.243536,52.005096,15.955868,8.433941,67.230606,16.53442,-14.507183,66.470596,19.542915,-30.141256,50.17025,23.219013,-29.310026,27.87812,25.041943,-12.414168,9.768799,39.585575,9.793187,17.787788,36.806087,24.237183,32.847328,32.433437,23.698524,45.778152,31.386242,7.939194,67.509125,31.920753,-13.255643,66.806961,33.723866,-27.470352,44.082985,38.096516,-26.931694,31.152161,40.120083,-11.401649,17.085632,4.083814,9.175353,9.411915,1.671699,23.533075,27.35527,-1.724573,22.765118,47.950523,-3.748147,7.235089,62.017067,-3.213637,-13.95975,61.314903,-0.43415,-28.403746,46.255356,2.962124,-27.635788,25.660103,4.618326,-12.019486,8.709751,51.200497,7.339968,25.494713,49.073166,18.394915,37.02079,45.497395,18.036449,45.119278,44.924999,5.920981,63.549789,45.334099,-10.300847,63.012375,46.48505,-21.126505,43.821846,50.06081,-20.768034,35.723358,51.609592,-8.881865,24.957298,-10.941463,6.174876,13.358334,
-12.753901,17.155888,27.356232,-15.353297,16.568123,43.119164,-16.902069,4.681944,53.885231,-16.492973,-11.539885,53.347816,-14.365645,-22.594837,41.821724,-11.766252,-22.007074,26.058807,-10.532363,-10.046953,12.820919,72.444061,2.311111,35.949776,73.46067,6.373803,38.509026,73.469582,5.201909,51.306015,72.972931,1.390288,54.758446,73.104118,-3.811674,54.586113,73.786301,-7.35674,50.889961,73.814957,-7.67468,38.04361,72.590813,-3.50796,35.756996,-24.213253,1.80878,22.523335,-25.364548,7.791679,28.7612,-26.771336,7.473584,37.292038,-27.609524,1.04083,43.118591,-27.388123,-7.738361,42.827744,-26.236824,-13.72126,36.589874,-24.83004,-13.403165,28.05904,-23.991852,-6.970411,22.232487,-30.550114,-3.059979,31.933128,73.385284,-1.028542,49.149261,42.401417,35.858101,22.061672,40.671612,35.466965,32.551346,47.325409,32.58313,32.215759,48.649345,32.882492,24.187313,42.522068,-37.908401,30.120491,44.251877,-37.517265,19.630821,50.345592,-34.37796,21.959034,49.02166,-34.677322,29.987488,71.026894,39.562119,
6.49543,71.809578,40.460907,12.847034,74.709991,27.929308,11.765472,74.110939,27.241405,6.904163,73.839088,-40.013954,10.180981,73.001541,-38.737564,3.901443,75.462013,-26.331263,5.129356,76.10305,-27.308151,9.935501,10.436533,30.26334,1.601849,8.367304,41.255341,11.170052,17.973839,35.384674,16.811943,20.509544,21.038153,4.514198,10.514552,-43.889061,8.349319,12.011738,-32.198051,-0.46743,21.61232,-22.690241,3.065525,19.822712,-37.928192,14.383167,-45.11322,15.181909,7.128574,-44.7262,27.89337,11.367073,-38.150036,20.656317,15.456547,-38.876595,4.159258,9.676434,-43.183998,-33.259636,9.341137,-44.217621,-20.331316,5.952053,-38.539658,-9.201324,9.233807,-36.973743,-25.987,13.911301,-51.514362,26.118031,11.472397,-38.998569,33.021893,7.568474,-40.780689,29.7167,16.120533,-57.718498,21.104891,16.223156,-37.211758,-37.830772,5.221199,-50.052753,-31.83919,9.55233,-56.4935,-27.470016,14.613922,-39.143776,-35.192398,13.970169,-31.676292,45.318993,7.549469,-30.537655,38.171364,8.792461,-31.498203,40.035736,
15.435646,-34.599983,50.729843,17.805222,-28.500267,-42.617363,6.116024,-29.279648,-49.715363,4.401077,-31.910091,-55.933044,14.271587,-29.354656,-44.963058,12.619736,-37.216404,47.961967,8.295517,-23.567535,54.160469,9.711559,-25.614941,52.727432,13.876205,-42.554642,44.692566,18.508041,-20.73241,-58.260979,5.987164,-34.678402,-52.677498,4.96143,-40.157452,-50.363678,15.358921,-22.842445,-57.211449,10.234058,-61.314365,66.06591,15.476387,-53.167393,78.374046,14.78936,-54.332058,75.71981,18.161579,-65.093681,59.917915,18.6735,-49.067055,-84.216965,9.402908,-57.822235,-72.407059,10.888927,-61.900997,-66.682098,14.479378,-50.358273,-81.853577,12.941353,54.031574,18.996731,60.804337,49.936047,10.318501,65.219086,61.565018,11.725041,62.912231,62.230419,12.618508,56.801773,52.398544,-16.579081,66.370148,52.024384,-22.135595,56.477509,64.084045,-17.632685,58.318565,62.152618,-11.547491,60.150208,53.165871,-21.177664,63.589088,59.564713,-21.727551,58.945068,64.103798,-15.852667,60.557838,58.37344,-15.402325,
65.551445,59.307095,-19.308857,64.84333,53.676453,16.823017,64.183708,57.780437,12.663898,65.313713,62.056858,13.410549,61.667755,58.464394,17.764549,60.702774,58.593113,16.867147,63.889343,50.562988,-14.541252,64.395508,62.94352,-15.65752,55.865021,51.37595,-19.413351,61.449028,58.155392,-19.995943,56.528793,62.964443,-13.771629,58.237488,56.893257,-13.294504,63.528107,50.999996,18.483866,57.823189,61.654621,8.199444,60.804398,50.497746,15.409562,62.602669,56.302044,9.527279,64.200851,62.350235,10.583276,59.044327,57.269371,16.74118,57.67955,60.220856,36.083054,5.114887,59.358284,36.791946,15.68932,63.747063,31.035082,15.132355,64.407249,30.492512,7.039032,61.223598,-37.172592,13.238953,62.031742,-35.723289,2.736015,65.93454,-30.0686,5.032696,65.316017,-31.177835,13.071297,72.677834,-8.280819,48.770477,72.355408,6.243657,49.258484,62.821701,9.269063,51.296844,61.983517,2.836307,57.123398,62.204914,-5.942883,56.83255,63.356216,-11.925779,50.594688,70.748993,-0.733785,38.177002,70.30481,-7.235699,
38.456001,70.006859,5.767277,38.862419,65.379791,3.604257,36.528145,64.004898,18.45307,43.059731,64.986588,-20.473593,41.770134,65.601189,-5.174932,36.237297,65.566345,-1.008477,42.51297,64.611755,-10.794163,42.001877,64.176468,8.813741,42.660675,75.569946,-0.644439,39.063454,74.75367,-12.593015,39.576164,74.206886,11.272151,40.322021,67.032394,-1.149662,47.960167,65.838448,-13.389107,47.320923,65.294403,11.119885,48.144394,79.626472,-0.846391,48.241531,74.340515,-11.626905,48.222237,73.866982,9.706098,48.939003,66.045784,-1.14924,47.031662,64.291542,-19.132408,46.092438,63.492374,16.870644,47.302101,8.367304,41.255341,11.170052,10.436533,30.26334,1.601849,17.973839,35.384674,16.811943,8.367304,41.255341,11.170052,20.509544,21.038153,4.514198,17.973839,35.384674,16.811943,10.436533,30.26334,1.601849,20.509544,21.038153,4.514198,12.011738,-32.198051,-0.46743,10.514552,-43.889061,8.349319,21.61232,-22.690241,3.065525,12.011738,-32.198051,-0.46743,19.822712,-37.928192,14.383167,21.61232,
-22.690241,3.065525,10.514552,-43.889061,8.349319,19.822712,-37.928192,14.383167),
		"pol"=c(1,2,9,2,3,11,3,4,12,4,5,13,5,6,13,6,7,14,7,8,16,8,1,9,17,18,1,18,19,3,19,20,4,20,21,5,21,22,6,22,23,7,23,24,8,24,17,1,9,10,26,11,12,28,12,13,29,13,14,29,15,16,32,16,9,25,34,35,19,35,36,20,36,37,21,37,38,22,38,39,23,40,33,17,49,50,34,50,51,35,51,52,36,52,53,37,53,54,38,54,55,39,55,56,39,56,49,33,57,56,55,57,55,54,57,54,53,57,53,52,57,52,51,57,51,50,57,50,49,57,49,56,10,11,60,11,27,61,27,26,61,26,10,62,14,15,63,15,31,65,31,30,66,30,14,66,67,68,69,71,72,74,33,34,75,34,18,76,18,17,78,17,33,75,39,40,80,40,24,80,24,23,81,23,39,79,75,76,84,76,77,85,77,78,85,78,75,86,79,80,87,80,81,89,81,82,90,82,79,90,83,84,91,84,85,93,85,86,94,86,83,94,87,88,96,88,89,97,89,90,97,90,87,98,91,92,99,92,93,101,93,94,102,94,91,102,95,96,104,96,97,105,97,98,105,98,95,106,99,100,108,100,101,109,101,102,110,102,99,107,103,104,111,104,105,112,106,114,113,106,103,114,107,108,116,108,109,116,109,110,117,110,107,115,115,116,117,111,112,119,112,113,120,113,114,122,114,111,119,119,120,122,135,129,133,132,129,135,135,127,
131,131,132,135,134,127,135,135,133,134,140,125,138,137,125,140,140,123,136,136,137,140,139,123,140,140,138,139,143,141,29,143,128,144,145,130,146,129,132,144,127,134,146,131,127,143,133,129,145,143,144,131,145,146,133,28,124,149,149,124,150,151,126,152,125,137,150,123,139,152,136,123,149,138,125,151,149,150,136,151,152,138,59,60,154,60,61,154,61,62,155,62,59,153,68,67,154,69,68,155,70,69,156,67,70,156,63,64,157,64,65,158,65,66,160,66,63,157,72,71,157,73,72,159,74,73,159,71,74,160,152,126,163,164,148,150,163,126,151,28,29,165,146,130,165,166,142,144,165,130,145,44,43,164,45,44,165,46,45,165,25,26,170,31,32,173,32,25,170,42,41,170,48,47,173,41,48,173,174,175,168,176,174,169,76,75,77,80,79,82,177,41,42,177,48,41,177,47,48,178,47,177,177,42,179,58,161,180,180,182,162,167,168,177,169,167,177,183,43,44,183,44,45,183,45,46,183,46,184,185,43,183,31,172,187,47,178,172,184,46,166,168,175,178,175,174,186,26,188,171,43,185,163,179,42,171,176,169,179,174,176,186,183,184,161,58,162,183,181,161,184,187,186,181,162,182,
185,186,188,182,2,10,9,2,11,10,3,12,11,4,13,12,6,14,13,7,15,14,7,16,15,8,9,16,18,2,1,18,3,2,19,4,3,20,5,4,21,6,5,22,7,6,23,8,7,24,1,8,9,26,25,11,28,27,12,29,28,14,30,29,15,32,31,16,25,32,34,19,18,35,20,19,36,21,20,37,22,21,38,23,22,40,17,24,49,34,33,50,35,34,51,36,35,52,37,36,53,38,37,54,39,38,56,40,39,56,33,40,10,60,59,11,61,60,26,62,61,10,59,62,15,64,63,15,65,64,31,66,65,14,63,66,67,69,70,72,73,74,34,189,190,18,191,192,18,193,194,17,195,196,39,197,198,24,199,200,23,201,202,23,203,204,75,84,83,76,85,84,78,86,85,75,83,86,80,88,87,80,89,88,81,90,89,79,87,90,84,92,91,84,93,92,85,94,93,83,91,94,87,96,95,88,97,96,90,98,97,87,95,98,92,100,99,92,101,100,93,102,101,91,99,102,95,104,103,96,105,104,98,106,105,95,103,106,99,108,107,100,109,108,101,110,109,102,107,110,104,112,111,105,113,112,106,113,105,103,111,114,107,116,115,109,117,116,110,118,117,110,115,118,115,117,118,112,120,119,113,121,120,113,122,121,114,119,122,120,121,122,143,29,128,29,30,128,129,144,142,127,146,141,127,141,143,129,142,145,144,132,131,
146,134,133,149,147,28,147,27,28,125,150,148,123,152,147,123,147,149,125,148,151,150,137,136,152,139,138,59,154,153,61,155,154,62,156,155,62,153,156,67,153,154,68,154,155,69,155,156,67,156,153,64,158,157,65,159,158,65,160,159,66,157,160,72,157,158,72,158,159,74,159,160,71,160,157,152,163,27,152,27,147,150,124,28,150,28,164,151,148,164,151,164,163,28,165,164,146,165,29,146,29,141,144,128,30,144,30,166,145,142,166,145,166,165,43,163,164,44,164,165,46,165,166,26,171,170,31,173,172,32,170,173,42,170,171,47,172,173,41,173,170,174,168,167,174,167,169,75,78,77,80,82,81,161,181,180,180,162,58,168,178,177,169,177,179,187,166,30,187,30,31,178,187,172,184,166,187,175,187,178,175,186,187,26,27,188,188,27,163,185,188,163,179,171,188,176,179,188,176,188,186,183,161,58,162,185,183,181,184,187,186,180,181,182,188,185,186,182,180),
		"con"=NULL))
	} 
plotPoints=function(tver=form("cube")$ver,add=F,col=c("lightgrey","black"),subset=NULL,xlim=NULL,ylim=NULL){
	if(is.null(xlim)|is.null(ylim)) {
	if(add==F) plot(c(min(tver),max(tver)),c(min(tver),max(tver)),type="n",axes=F,xlab=NA,ylab=NA)}else
	if(add==F) plot(c(xlim[1],xlim[2]),c(ylim[1],ylim[2]),type="n",axes=F,xlab=NA,ylab=NA)
	z=sapply(seq(1,length(tver),by=3),function(i) tver[i+2])
    if(is.null(col))col="black";
    if(length(col)==1)col=rep(col,2)
	cols=colorRampPalette(c(col[2],col[1]))(length(levels(as.factor(z))));
	if(!is.null(subset)){
		if(subset=="front")cols[z<=0]=NA
		if(subset=="back")cols[z>0]=NA
	}
	co=0
	for(i in seq(1,length(tver),by=3)){
		co=co+1
		points(tver[i+0],tver[i+1],pch=16,col=cols[rank(z,ties.method="min")[co]])
	}
}
plotWireframe=function(tver=form("cube")$ver,con=form("cube")$con,add=F,col=c("lightgrey","black"),subset=NULL,xlim=NULL,ylim=NULL,fun=mean){
	if(is.null(xlim)|is.null(ylim)) {   
	if(add==F) plot(c(min(tver),max(tver)),c(min(tver),max(tver)),type="n",axes=F,xlab=NA,ylab=NA)}else
	if(add==F) plot(c(xlim[1],xlim[2]),c(ylim[1],ylim[2]),type="n",axes=F,xlab=NA,ylab=NA)
	con=sortCon(con,tver,fun);
	z=sapply(seq(1,length(con),by=2),function(i) (tver[con[i]*3]+tver[con[i+1]*3])/2)
    if(is.null(col))col="black";
    if(length(col)==1)col=rep(col,2)
	cols=colorRampPalette(c(col[2],col[1]))(length(levels(as.factor(z))));
	if(!is.null(subset)){
		if(subset=="front")cols[z<=0]=NA
		if(subset=="back")cols[z>0]=NA
	}
	co=0
	for(i in seq(1,length(con),by=2)){
		co=co+1
		segments(tver[con[i]*3-2],tver[con[i]*3-1],tver[con[i+1]*3-2],tver[con[i+1]*3-1],
		col=cols[rank(z,ties.method="min")[co]])
	}
}
plotPolygons=function(tver=form("cube")$ver,pol=form("cube")$pol,add=F,col="lightgrey",transparency=0,border="black",culling="none",xlim=NULL,ylim=NULL,fun=mean){
	if(is.null(xlim)|is.null(ylim)) {
	if(add==F) plot(c(min(tver),max(tver)),c(min(tver),max(tver)),type="n",axes=F,xlab=NA,ylab=NA)}else
	if(add==F) plot(c(xlim[1],xlim[2]),c(ylim[1],ylim[2]),type="n",axes=F,xlab=NA,ylab=NA)
	if(is.null(culling))culling="none"
	pol=sortPol(pol,tver,fun);
	cols=colourPol(pol,tver,col,transparency=transparency)
    borders=NULL;
    if (is.null(border)) 
        borders = cols
    if (length(borders) != length(cols)) 
        borders = rep(border[1], length(cols))
    else borders = cols
	co=0
	for(i in seq(1,length(pol),by=3)){
		co=co+1
      		cp=vecCrossProduct(
            		c(tver[pol[i+1]*3-2]-tver[pol[i+0]*3-2],tver[pol[i+1]*3-1]-tver[pol[i+0]*3-1],tver[pol[i+1]*3-0]-tver[pol[i+0]*3-0]),
            		c(-tver[pol[i+2]*3-2]+tver[pol[i+0]*3-2],-tver[pol[i+2]*3-1]+tver[pol[i+0]*3-1],-tver[pol[i+2]*3-0]+tver[pol[i+0]*3-0]))
  		if((culling!="front"&culling!="back")|(cp%*%c(0,0,-1)>=0&culling=="back")|(cp%*%c(0,0,-1)<=0&culling=="front"))
		polygon(
			x=c(tver[pol[i]*3-2],tver[pol[i+1]*3-2],tver[pol[i+2]*3-2]),
			y=c(tver[pol[i]*3-1],tver[pol[i+1]*3-1],tver[pol[i+2]*3-1]),
			col=cols[co],border=borders[co])
	}
}
interactivePolygonPlot=function(rver=unitRver(),pol=form("cube")$pol,border="blue",xlim=NULL,ylim=NULL,culling="back"){
    dev.new();
    if(is.null(xlim))xlim=c(min(tver),max(tver))
    if(is.null(ylim))ylim=c(min(tver),max(tver))
    p=function(a=F,tx=0,ty=0,tz=0){
    print(paste(tx,";",ty,";",tz))
    	tver=transformRver(rver,ver,thetaX=tx,thetaY=ty,thetaZ=tz);
    	plotPolygons(tver,pol,border=border,xlim=xlim,ylim=ylim,add=a,culling=culling);
    }
    p(F)
    thetax=0;thetay=0;
    toDegree <- function(rad) rad * 57.29577951308232286465 
    toRadians <- function(deg) deg / 57.29577951308232286465 
    f=function(prompt="Move the cube with cursor keys") getGraphicsEvent(
    	prompt=prompt,
    	onKeybd=function(x){
    		if(x=="ctrl-["){ print(paste("thetax=",thetax,"; thetay=",thetay)); return("ctrl-[")}
    		if(x=="Down")  thetax<<-thetax+5
    		if(x=="Left")  thetay<<-thetay+5
    		if(x=="Right") thetay<<-thetay-5
    		if(x=="Up")    thetax<<-thetax-5
    		if(thetax>360)thetax<<-thetax-360
    		if(thetay>360)thetay<<-thetay-360
    		if(thetax<0)thetax<<-360+thetax
       		if(thetay<0)thetay<<-360+thetay
	    	p(F,thetax,thetay);
	    	f(paste(x,"; ",thetax,";",thetay));
	    	return(-1)
	    	NULL}
    )
    f()
}
scattergram3D=function(x=NULL,y=NULL,z=NULL,thetaX=320,thetaY=320,thetaZ=0,col=c("darkgrey","black"),add.polygon=F,border=NA, main="3D Scattergram"){
    if(is.null(x)&is.null(y)&is.null(z)){ x=rnorm(100);y=rnorm(100);z=rnorm(100); }
    cube=form("cube")    
    ver=cube$ver
    con=cube$con
    pol=cube$pol
    rver=unitRver()
    tver=transformRver(rver,ver,thetaX,thetaY,thetaZ)
    max=max(c(abs(x),abs(y),abs(z)),na.rm=T)
    x=x/max;y=y/max;z=z/max;
    poi=vecToVer(x,y,z)
    tver2=transformRver(rver,poi,thetaX,thetaY,thetaZ)
    if(add.polygon)plotPolygons(tver,pol,culling="front",border=border,add=F,col=col);
    if(is.null(col))col="black";
    if(length(col)==1)col=rep(col,2)
    plotWireframe(tver,con,add=F,subset="back")
    plotPoints(tver2,add=T,col=col)
    plotWireframe(tver,con,add=T,subset="front")
    if(!is.null(main))title(main)
    invisible(list("ver"=ver,"tver"=tver2))
}

barplot3D=function(x=NULL,col=NULL,transparency=.2,border=NA,xlim=NULL,ylim=NULL,main="3D Barplot",thetaX=10,thetaY=10,thetaZ=0,add.numbers=F,txt.srt=0,txt.pos=3){   
    if(is.null(x))x=cbind(c(1,2,3),c(2,2,2),c(3,2,1))
    x=cbind(x);    
    bar=list(
   		"ver"=c(-1,0,-1, +1,0,-1, +1,0,+1, -1,0,+1, -1,+2,-1, +1,+2,-1, +1,+2,+1, -1,+2,+1),
		"pol"=c(1,3,2, 1,4,3, 5,6,7, 5,7,8, 1,2,5, 2,6,5, 2,3,7, 2,7,6, 1,8,4, 1,5,8, 3,4,8, 3,8,7),
		"con"=c(1,2, 2,3, 3,4, 1,4, 5,6, 6,7, 7,8, 5,8, 1,5, 2,6, 3,7, 4,8))
    ver=bar$ver
    con=bar$con
    pol=bar$pol
    rver=unitRver()
    tver=transformRver(rver,ver,thetaX=thetaX,thetaY=thetaY,thetaZ=thetaZ);
    ver2=ver
    ver2[seq(1,length(ver),by=3)+1] = ver[seq(1,length(ver),by=3)+1]*max(x)
    ver2[seq(1,length(ver),by=3)+2] = ver[seq(1,length(ver),by=3)+2]+(dim(x)[2]-1)*3
    ver2[seq(1,length(ver),by=3)+0] = ver[seq(1,length(ver),by=3)+0]+(1-1)*3
    ver3=ver
    ver3[seq(1,length(ver),by=3)+1] = ver[seq(1,length(ver),by=3)+1]*0
    ver3[seq(1,length(ver),by=3)+2] = ver[seq(1,length(ver),by=3)+2]+(1-1)*3
    ver3[seq(1,length(ver),by=3)+0] = ver[seq(1,length(ver),by=3)+0]+(dim(x)[1]-1)*3
    tver2=transformRver(rver,ver2,thetaX=thetaX,thetaY=thetaY,thetaZ=thetaZ);
    tver3=transformRver(rver,ver3,thetaX=thetaX,thetaY=thetaY,thetaZ=thetaZ);
    if(is.null(xlim))xlim=c(
            min(tver2[seq(1,length(tver2),by=3)+0]),
            max(tver2[seq(1,length(tver2),by=3)+0]+(dim(x)[1]-1)*3))
    d1=abs(min(tver2[seq(1,length(tver2),by=3)+1])-min(tver3[seq(1,length(tver3),by=3)+1]))
    d2=(sort(tver2[seq(1,length(tver2),by=3)+1],decreasing=T)[1:2]);d2=d2[1]-d2[2]
    if(is.null(ylim))ylim=c(
            min(tver2[seq(1,length(tver2),by=3)+1])-d1*dim(x)[2],
            max(tver2[seq(1,length(tver2),by=3)+1])+d2*dim(x)[1])
    plotPolygons(tver,pol,col=NA,transparency=transparency,border=border,xlim=xlim,ylim=ylim,add=F,culling="back");
    if(is.null(col))col=rainbow(dim(x)[1])
    k=1;x1=numeric(0);y1=numeric(0);v1=numeric(0);
    for(i in 1:dim(x)[1])
        for(j in dim(x)[2]:1){         
            ver2=ver
            ver2[seq(1,length(ver),by=3)+1] = ver[seq(1,length(ver),by=3)+1]*x[i,j]
            ver2[seq(1,length(ver),by=3)+2] = ver[seq(1,length(ver),by=3)+2]+(j-1)*3
            ver2[seq(1,length(ver),by=3)+0] = ver[seq(1,length(ver),by=3)+0]+(i-1)*3            
            tver2=transformRver(rver,ver2,thetaX=thetaX,thetaY=thetaY,thetaZ=thetaZ);
            plotPolygons(tver2,pol,col=col[i],transparency=transparency,border=border,xlim=xlim,ylim=ylim,add=T,culling="back");
            k=k+1
            x1=c(x1,mean(tver2[seq(1,length(tver),by=3)+0][order(tver2[seq(1,length(tver),by=3)+1],decreasing=T)[1:2]]))
            y1=c(y1,max(tver2[seq(1,length(tver),by=3)+1]))
            v1=c(v1,x[i,j])
    }
    if(!is.null(main))title(main)
    if(add.numbers==T)text(x1,y1,v1,srt=txt.srt,pos=txt.pos,xpd=T)
    return(list(x=x1,y=y1,value=v1))
}
surfaceplot3D=function(x=-10:10,y=-10:10,fun=NULL,dim=c(10,10),col=rgb(0,0,1),border=NA,main="3D Surfaceplot",transparency=.1,thetaX=10,thetaY=60,thetaZ=10,culling="none",add.wireframe=T,add.polygons=T,...){
    if(is.null(fun))fun=function(x,y)x*y
    x=rep(seq(min(x),max(x),length.out=dim[1]),times=dim[2])
    y=rep(seq(min(y),max(y),length.out=dim[2]),each=dim[2])
    z=fun(x,y)
    ver=vecToVer(x,z,y)
    pol=numeric(0);
    con=numeric(0);
    for(j in 1:(dim[2]-1)){
        for(i in 1:(dim[1]-1)){ #(dim[1]*dim[2]-dim[1]-1)){
            pol=c(pol,
                    (dim[1]*(j-1))+i+0,(dim[1]*(j-1))+i+dim[1]+0,(dim[1]*(j-1))+i+dim[1]+1, 
                    (dim[1]*(j-1))+i+0,(dim[1]*(j-1))+i+dim[1]+1,(dim[1]*(j-1))+i+1)
            con=c(con,
                    (dim[1]*(j-1))+i,(dim[1]*(j-1))+i+1,
                    (dim[1]*(j-1))+i+1,(dim[1]*(j-1))+i+dim[1]+1,
                    (dim[1]*(j-1))+i+dim[1]+1,(dim[1]*(j-1))+i+dim[1]+0,
                    (dim[1]*(j-1))+i+dim[1]+0,(dim[1]*(j-1))+i
                    )
        }
    }
    ver[seq(1,length(ver),by=3)+0]=(ver[seq(1,length(ver),by=3)+0])/(max(ver[seq(1,length(ver),by=3)+0]))
    ver[seq(1,length(ver),by=3)+1]=(ver[seq(1,length(ver),by=3)+1])/(max(ver[seq(1,length(ver),by=3)+1]))
    ver[seq(1,length(ver),by=3)+2]=(ver[seq(1,length(ver),by=3)+2])/(max(ver[seq(1,length(ver),by=3)+2]))
    rver=unitRver()
    cube=form("cube")
    tver=transformRver(rver,ver,thetaX=thetaX,thetaY=thetaY,thetaZ=thetaZ)
    tver2=transformRver(rver,cube$ver,thetaX=thetaX,thetaY=thetaY,thetaZ=thetaZ)
    plotWireframe(tver2,cube$con,add=F,subset="back")
    if(add.polygons)plotPolygons(tver,pol,border=border,add=T,col=col,culling=culling,transparency=transparency,...)
    if(add.wireframe)plotWireframe(tver,con,add=T,col=c(col,"black"))
    plotWireframe(tver2,form("cube")$con,add=T,subset="front")
    if(!is.null(main))title(main)
    invisible(list("ver"=ver,"tver"=tver,"pol"=pol,"con"=con))
}


######################
# Build threeD-Package
######################

functions=ls()

library(roxygen2)
library(devtools)
package.name="threeD";
remove.packages(package.name); 
g=getwd();
dir.create("MyPackages");
setwd("MyPackages")

if(F){
	remove.packages("threeD"); 
	devtools::install_github("AndreasFischer1985/qqBaseX")
}

create=function(name, description, 
	rproj=list("Version"="1.0","RestoreWorkspace"="No","SaveWorkspace"="No","AlwaysSaveHistory"="Default","EnableCodeIndexing"="Yes","Encoding"="UTF-8","AutoAppendNewline"="Yes","StripTrailingWhitespace"="Yes","BuildType"="Package","PackageUseDevtools"="Yes","PackageInstallArgs"="--no-multiarch --with-keep.source","PackageRoxygenize"="rd,collate,namespace"),
	gitignore=c(".Rproj.user"),
	rbuildignore=c(paste0("^",name,"\\.Rproj$"),"^\\.Rproj\\.user$")
){
	wd=getwd()
	if(!dir.exists(name))dir.create(name);
	setwd(name)
	writeList=function(list,file)write(paste0(names(list),(unlist(lapply(list,function(x)paste0(": ",x))))),file=file)
	writeList(list=description,file="DESCRIPTION")
	writeList(list=rproj,file=paste0(name,".Rproj"))
	write(gitignore,file=".gitignore")
	write(rbuildignore,file=".RBuildignore")
	setwd(wd)
};

create(package.name,
description=list(
"Package"="threeD",
"Title"="Basic functions for plotting and manipulating 3D-Objects based on R's default packages.",
"Version"="0.0.4",
"Authors@R"="person(\"Andreas\", \"Fischer\", email = \"andreasfischer1985@web.de\", role = c(\"aut\", \"cre\"))",
"Maintainer"="'Andreas Fischer' <andreasfischer1985@web.de>",
"Description"=
paste(
	"The threeD package provides basic functions for parsing, plotting and manipulating 3D-Objects. It was written to extend R's default packages without introducing dependencies on other packages."
),
"Depends"="R (>= 3.0.0)",
"License"="GPL-2",
"Encoding"="UTF-8",
"LazyData"="true",
"RoxygenNote"="6.1.0",
"VignetteBuilder"="knitr")
);

setwd(package.name)
readLines("DESCRIPTION")

if(!dir.exists("R"))dir.create("R");
setwd("R")

for(i in 1:length(functions))
    write(
        paste0("#' Function ",functions[i],"\n#' \n#' @export\n",
            functions[i]," <- ",
            paste(deparse(get(functions[i])),collapse="\n")),
        file=paste0(functions[i],".r"))

setwd("..");
devtools::document();
setwd("..");
devtools::install(package.name);


####################
# Examples
####################

library(threeD)

dev.new();
f=surfaceplot3D(fun=function(x,y)x*y);

x=cbind(c(1,2,3),c(2,2,2),c(3,2,1))
dev.new();
b=barplot3D(x,add.numbers=T)

set.seed(0)
dev.new();
scattergram3D(rnorm(100),rnorm(100),rnorm(100))		 

ver=form("sphere")$ver
con=form("sphere")$con
pol=form("sphere")$pol
rver=unitRver()
tver=transformRver(rver,ver,thetaX=10,thetaY=10,thetaZ=10);
nv=length(ver)/3
nc=length(con)/2
np=length(pol)/3
dev.new();
plotPolygons(tver,pol,col="red",border=NA,add=F,culling="back");

ver=form("cone")$ver
con=form("cone")$con
pol=form("cone")$pol
rver=unitRver()
tver=transformRver(rver,ver,thetaX=10,thetaY=10,thetaZ=10);
dev.new();
par(mfrow=c(4,5))
a=seq(10,360,length.out=5);
for(i in a) {par(mar=c(0,0,0,0));tver=transformRver(rver,ver,thetaX=i,thetaY=0,thetaZ=0);plotPolygons(tver,pol,border="blue", add=F);}
for(i in a) {par(mar=c(0,0,0,0));tver=transformRver(rver,ver,thetaX=0,thetaY=i,thetaZ=0);plotPolygons(tver,pol,border="blue", add=F);}
for(i in a) {par(mar=c(0,0,0,0));tver=transformRver(rver,ver,thetaX=0,thetaY=0,thetaZ=i);plotPolygons(tver,pol,border="blue", add=F);}
for(i in a) {par(mar=c(0,0,0,0));tver=transformRver(rver,ver,thetaX=i,thetaY=i,thetaZ=i);plotPolygons(tver,pol,border="blue", add=F);}

ver=form("cube")$ver
con=form("cube")$con
pol=form("cube")$pol
rver=unitRver()
tver=transformRver(rver,ver,thetaX=20,thetaY=340,thetaZ=0);
interactivePolygonPlot(rver,pol,xlim=c(-2,2),ylim=c(-2,2))



